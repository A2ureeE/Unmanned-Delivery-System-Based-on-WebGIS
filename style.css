/**
 * ============================================
 * 校园无人书车调度系统 - 样式表 (Modern Light Theme)
 * ============================================
 * Design: Clean, Material Interactive, Fresh Colors, Day Mode
 */

/* ========================================
   1. 全局变量与重置
   ======================================== */
:root {
    --primary-color: #2196F3;
    --primary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --secondary-color: #f5f7fa;
    --secondary-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    --text-primary: #2c3e50;
    --text-secondary: #7f8c8d;
    --bg-color: #fdfdfd;
    --sidebar-bg: rgba(255, 255, 255, 0.95);

    --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);

    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;

    --font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;

    /* Glassmorphism System */
    --glass-bg: rgba(255, 255, 255, 0.45);
    --glass-border: 1px solid rgba(255, 255, 255, 0.6);
    --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
    --glass-blur: blur(20px) saturate(180%);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

html,
body {
    width: 100%;
    height: 100%;
    font-family: var(--font-family);
    overflow: hidden;
    background-color: var(--secondary-color);
    color: var(--text-primary);
}

/* ========================================
   2. 地图容器
   ======================================== */
#map-container {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
}

/* ========================================
   3. 控制面板 (Compact Float Card)
   ======================================== */
#control-panel {
    position: absolute;
    top: 20px;
    /* Reverted for Dynamic Island Nav */
    left: 20px;
    width: 360px;
    /* 稍微减小宽度 */
    /* 限制最大高度为视口高度减去上下间距 */
    overflow-y: auto;
    /* 内容超出时显示垂直滚动条 */
    padding: 0;
    /* Remove default padding for full-width header */
    /* 减小内边距 */

    /* Premium Glassmorphism */
    background: var(--glass-bg);
    border-radius: var(--radius-md);

    /* 增加 Flex 布局以支持 Header 区域的复杂排版 */
    display: flex;
    flex-direction: column;
    gap: 20px;

    box-shadow: var(--glass-shadow);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border: var(--glass-border);
    border-bottom: 10px solid transparent;

    z-index: 100;
    transition: all 0.3s ease;
}

/* Header Styling (New Premium Look) */
.panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;

    /* Gradient Background for Distinction */
    /* Clean Header */
    background: transparent;

    padding: 16px 20px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);

    /* Top rounded corners to match container */
    border-top-left-radius: var(--radius-md);
    border-top-right-radius: var(--radius-md);
}

/* Add padding back to content elements via a wrapper or direct selector if needed.
   Currently, the content following the header is direct. We should wrap it div? 
   No, we can just apply padding to valid children or wrap logic. 
   Actually, easiest is to wrap the REST of the content in index.html, 
   OR just apply padding to them via a new rule or > *:not(.panel-header).
*/
#control-panel>*:not(.panel-header) {
    margin-left: 16px;
    margin-right: 16px;
}

#control-panel>.form-group:first-of-type {
    margin-top: 10px;
    /* Extra nudge for the first item */
}

/* Update Header Text Gradient */
.panel-header h2 {
    font-size: 18px;
    /* 减小标题 */
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0;
    /* Removed bottom margin */
    padding-bottom: 12px;
    border-bottom: 1px solid #f0f2f5;
    background: linear-gradient(to right, #2196F3, #21CBF3);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* 志愿者Badge样式 (New) */
.volunteer-badge {
    display: inline-flex;
    align-items: center;
    background: linear-gradient(135deg, #e0f7fa 0%, #80deea 100%);
    padding: 4px 10px;
    border-radius: 20px;
    margin-right: auto;
    /* Push theme toggle to right if in flex container */
    margin-left: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.5);
    font-size: 12px;
    color: #006064;
    transition: all 0.3s ease;
}

.volunteer-badge.unavailable {
    background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
    color: #c62828;
    border-color: #ffcdd2;
}

.volunteer-icon {
    margin-right: 4px;
    font-size: 14px;
}

.volunteer-label {
    font-weight: 600;
    margin-right: 4px;
}

#volunteer-count {
    font-weight: 800;
    font-family: 'Segoe UI', sans-serif;
}

/* Dark Mode Adaptation for Volunteer Badge */
[data-theme="dark"] .volunteer-badge {
    background: linear-gradient(135deg, #004d40 0%, #00695c 100%);
    color: #b2dfdb;
    border-color: #004d40;
}

[data-theme="dark"] .volunteer-badge.unavailable {
    background: linear-gradient(135deg, #b71c1c 0%, #c62828 100%);
    color: #ffcdd2;
    border-color: #b71c1c;
}

/* ========================================
   4. 表单元素 (Compact)
   ======================================== */
/* ========================================
   4. 表单元素 (Neumorphic Style)
   ======================================== */
.form-group {
    margin-bottom: 0;
    /* Handled by gap */
}

.form-group label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: var(--text-primary);
    margin-bottom: 8px;
    font-weight: 700;
}

/* Neumorphic Dropdown (Inset Style) */
.form-group select {
    width: 100%;
    padding: 14px 18px;
    font-size: 14px;
    font-weight: 500;

    /* Neumorphic Background & Text */
    background-color: var(--neu-bg);
    color: var(--neu-text);

    /* No borders, just shadows */
    border: none;
    border-radius: 12px;
    cursor: pointer;
    appearance: none;
    transition: all 0.3s ease;

    /* INSET SHADOW - The key for input fields */
    box-shadow: inset 4px 4px 8px var(--neu-shadow-dark),
        inset -4px -4px 8px var(--neu-shadow-light);

    /* Custom Arrow */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%234a5568' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 18px center;
}

/* Hover Effect - Slightly reduce depth or change color */
.form-group select:hover {
    color: var(--neu-accent);
    /* box-shadow: inset 2px 2px 5px var(--neu-shadow-dark),
                inset -2px -2px 5px var(--neu-shadow-light); */
}

/* Focus State - Deeper indent or accent color */
.form-group select:focus {
    outline: none;
    color: var(--neu-accent);
    box-shadow: inset 6px 6px 12px var(--neu-shadow-dark),
        inset -6px -6px 12px var(--neu-shadow-light);
}

/* ========================================
   Custom Neumorphic Select (Simulated)
   ======================================== */
.custom-select-wrapper {
    position: relative;
    user-select: none;
    width: 100%;
}

.custom-select {
    position: relative;
    display: flex;
    flex-direction: column;
}

/* The Trigger (looks like the input) */
.custom-select-trigger {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 18px;
    font-size: 14px;
    font-weight: 500;
    color: var(--neu-text);
    background: var(--neu-bg);
    border-radius: 12px;
    cursor: pointer;
    /* Inset shadow for "pressed" input field look */
    box-shadow: inset 3px 3px 6px var(--neu-shadow-dark),
        inset -3px -3px 6px var(--neu-shadow-light);
    transition: all 0.3s;
}

/* Arrow */
.custom-select-trigger:after {
    content: '';
    width: 8px;
    height: 8px;
    border-right: 2px solid var(--text-secondary);
    border-bottom: 2px solid var(--text-secondary);
    transform: rotate(45deg);
    transition: transform 0.3s;
    margin-right: 4px;
}

.custom-select.open .custom-select-trigger:after {
    transform: rotate(-135deg);
    margin-top: 4px;
}

.custom-select-trigger:hover {
    color: var(--neu-accent);
}

/* The Dropdown Options (The Window) */
.custom-options {
    position: absolute;
    top: 100%;
    /* Below the trigger */
    left: 0;
    right: 0;

    background: var(--neu-bg);
    border-radius: 12px;
    /* THE ROUNDED CORNERS REQUESTED */

    /* Outset shadow for Floating Window effect */
    box-shadow: 6px 6px 12px var(--neu-shadow-dark),
        -6px -6px 12px var(--neu-shadow-light);

    margin-top: 12px;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transform: translateY(-8px);
    transition: all 0.3s cubic-bezier(0.5, 0, 0, 1.25);
    z-index: 10000;
    overflow: hidden;
    /* Clips children to rounded corners */
}

.custom-select.open .custom-options {
    opacity: 1;
    visibility: visible;
    pointer-events: all;
    transform: translateY(0);
}


/* ========================================
   10. Top Navigation Bar (Dynamic Island Style)
   ======================================== */
.glass-nav {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: auto;
    min-width: 600px;
    height: 64px;

    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 12px 0 24px;
    /* More padding on left for text, less on right for button */

    /* Dynamic Island Aesthetics: Glass Pill */
    border-radius: 40px;
    background: var(--glass-bg);
    box-shadow: var(--glass-shadow);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border: var(--glass-border);

    z-index: 1000;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

[data-theme="dark"] .glass-nav {
    background: rgba(30, 41, 59, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
}

/* Hover effect for the "Island" */
.glass-nav:hover {
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    transform: translateX(-50%) translateY(2px);
}

.nav-left {
    display: flex;
    align-items: center;
    gap: 20px;
    height: 100%;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
}

.nav-label {
    font-size: 13px;
    color: var(--text-secondary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.nav-value {
    font-size: 15px;
    font-weight: 700;
    color: var(--text-primary);
    padding: 6px 14px;
    min-width: 80px;
    text-align: center;
    transition: all 0.3s ease;
}

/* Updated Badge Styles for Island Look */
.nav-value.status-idle {
    border-radius: 20px;
    background: #f1f3f5;
    color: #57606a;
    border: none;
}

.nav-value.status-moving,
.nav-value.status-waiting,
.nav-value.status-arrived,
.nav-value.status-returning {
    border-radius: 20px;
    /* Colors handled by class logic in script, but ensure border is none for slick look */
    border: none;
    box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
}

.nav-value.status-emergency {
    color: #d32f2f;
    background: #ffebee;
    border-radius: 20px;
    border: none;
    box-shadow: inset 0 0 0 1px rgba(211, 47, 47, 0.2);
    animation: flash-red 1.5s infinite;
}

@keyframes flash-red {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.6;
    }
}

/* Generic Emergency Status for Control Panel */
.status-emergency {
    color: #d32f2f !important;
    font-weight: 700;
}

.nav-value.code-text {
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 18px;
    letter-spacing: 2px;
    color: var(--primary-color);
    background: transparent;
    padding: 0;
    border-radius: 0;
}

.nav-divider {
    width: 2px;
    height: 16px;
    background-color: rgba(0, 0, 0, 0.06);
    border-radius: 2px;
}

[data-theme="dark"] .nav-divider {
    background-color: rgba(255, 255, 255, 0.15);
}

/* Old Contact Button Styles Removed */

/* Responsive */
@media (max-width: 768px) {
    .glass-nav {
        min-width: unset;
        width: 90%;
        padding: 0 4px 0 16px;
        height: 56px;
    }

    .nav-label {
        display: none;
    }

    .nav-left {
        gap: 12px;
    }

    .nav-value {
        min-width: unset;
        font-size: 14px;
        padding: 4px 8px;
    }

    /* Dont expand button on mobile, too cramped */
    /* Button keeps expanded state in mobile */
    .nav-btn {
        width: auto;
    }

    /* Hide Top Contact Button in Vertical/Mobile View */
    #contact-admin-btn {
        display: none !important;
    }
}

/* Also ensure it is hidden if the Body has vertical-mode class (Desktop emulation) */
body.vertical-mode #contact-admin-btn {
    display: none !important;
}

/* New Island Contact Button */
.neu-icon-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: #f1f3f5;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
}

.neu-icon-btn:hover {
    background: #e9ecef;
    transform: scale(1.05);
}

.neu-icon-btn.small {
    width: 32px;
    height: 32px;
}

/* Island Contact Button (Premium Style) */
#island-contact-btn {
    background: white;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    color: #2196F3;
    /* Icon color */
    margin-right: 12px !important;
    /* Adjust spacing */
}

#island-contact-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(33, 150, 243, 0.2);
}

/* Premium Purple Gradient Button */
.btn-gradient-purple {
    background: linear-gradient(135deg, #a55eea 0%, #7d5fff 100%);
    color: white;
    border: none;
    box-shadow: 0 4px 15px rgba(125, 95, 255, 0.3);
    border-radius: var(--radius-md);
    padding: 10px 20px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.btn-gradient-purple:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(125, 95, 255, 0.45);
    background: linear-gradient(135deg, #b06dec 0%, #886eff 100%);
}

.btn-gradient-purple:active {
    transform: translateY(0);
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* Option Item */
.custom-option {
    padding: 12px 18px;
    font-size: 13px;
    font-weight: 500;
    color: var(--neu-text);
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 1px solid rgba(0, 0, 0, 0.03);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.custom-option:last-child {
    border-bottom: none;
}

.custom-option:hover {
    color: var(--neu-accent);
    background: rgba(255, 255, 255, 0.4);
}

.custom-option.selected {
    color: var(--primary-color);
    font-weight: 700;
    background: rgba(33, 150, 243, 0.05);
    /* Very light blue tint */
}

/* Disabled option */
.custom-option.disabled {
    color: #bdc3c7;
    cursor: not-allowed;
    background: transparent;
}

/* 辅助文本 */
.subtext {
    font-size: 12px;
    color: var(--text-secondary);
    line-height: 1.3;
    margin-top: 4px;
}

.route-hint {
    background: #e3f2fd;
    padding: 8px 10px;
    border-radius: var(--radius-sm);
    border-left: 3px solid #2196F3;
    color: #1565c0;
    margin: 0;
    /* Handled by gap */
    font-size: 12px;
}

.form-group.compact {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 5px;
    margin-bottom: 10px;
}

/* ========================================
   5. 按钮样式 (Compact)
   ======================================== */
.button-row {
    display: flex;
    gap: 10px;
    margin: 0;
    /* Handled by gap */
}

/* Equal width button row for camera/emergency stop */
.button-row-equal {
    display: flex;
    gap: 10px;
    margin: 0;
}

.button-row-equal .flex-1 {
    flex: 1;
    min-width: 0;
}

/* Danger button style */
/* Danger button style - Alerting Red Background */
/* Danger button style - Alerting Red Background */
.neumorphic-btn.danger {
    background: linear-gradient(135deg, #ef5350 0%, #d32f2f 100%);
    color: white;
    /* Neumorphic Double Shadow: Darker Red Bottom-Right, Lighter Red Top-Left */
    box-shadow: 6px 6px 12px rgba(183, 28, 28, 0.4),
        -6px -6px 12px rgba(255, 117, 117, 0.4);
    border: none;
}

.neumorphic-btn.danger:hover {
    background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
    color: white;
    transform: translateY(-2px);
    box-shadow: 8px 8px 16px rgba(183, 28, 28, 0.5),
        -8px -8px 16px rgba(255, 117, 117, 0.5);
}

.neumorphic-btn.danger:active {
    transform: translateY(0);
    box-shadow: inset 3px 3px 6px rgba(130, 0, 0, 0.4),
        inset -3px -3px 6px rgba(255, 150, 150, 0.4);
}

.neumorphic-btn.danger .neu-icon {
    color: white;
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
}

/* Task End Mode Button - Orange/Warning Style */
#call-btn.task-end-mode {
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%) !important;
    color: white !important;
    box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
    animation: pulse-warning 2s infinite ease-in-out;
}

#call-btn.task-end-mode:hover {
    background: linear-gradient(135deg, #fb8c00 0%, #ef6c00 100%) !important;
    box-shadow: 0 6px 20px rgba(255, 152, 0, 0.5);
    transform: translateY(-2px);
}

#call-btn.task-end-mode .neu-icon {
    color: white !important;
}

@keyframes pulse-warning {
    0% {
        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
    }

    50% {
        box-shadow: 0 4px 25px rgba(255, 152, 0, 0.7);
    }

    100% {
        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
    }
}

/* Modal Action Buttons Unity */
.modal-action-row {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin-top: 24px;
}

.confirm-btn-danger {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: var(--radius-md);
    background: linear-gradient(135deg, #ef5350 0%, #d32f2f 100%);
    color: white;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(211, 47, 47, 0.3);
    transition: all 0.2s;
}

.confirm-btn-danger:hover {
    box-shadow: 0 6px 16px rgba(211, 47, 47, 0.4);
    transform: translateY(-2px);
}

/* Resume button style */
/* Resume button style - Green Background & Shadow */
.neumorphic-btn.resume {
    background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%);
    color: white;
    /* Neumorphic Double Shadow: Darker Green Bottom-Right, Lighter Green Top-Left */
    box-shadow: 6px 6px 12px rgba(27, 94, 32, 0.3),
        -6px -6px 12px rgba(129, 199, 132, 0.4);
    border: none;
}

.neumorphic-btn.resume:hover {
    background: linear-gradient(135deg, #57a65b 0%, #388e3c 100%);
    color: white;
    transform: translateY(-2px);
    box-shadow: 8px 8px 16px rgba(27, 94, 32, 0.4),
        -8px -8px 16px rgba(129, 199, 132, 0.5);
}

.neumorphic-btn.resume:active {
    transform: translateY(0);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15);
}

/* ========================================
   Glass Card (Previously Missing)
   ======================================== */
.glass-card {
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    /* Safari */
    border: var(--glass-border);
    box-shadow: var(--glass-shadow);
    border-radius: var(--radius-md);
    transition: all 0.3s ease;
}

[data-theme="dark"] .glass-card {
    background: var(--glass-bg);
    border-color: rgba(255, 255, 255, 0.1);
}

.neumorphic-btn.resume .neu-icon {
    color: white;
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
}

button {
    font-family: inherit;
    border: none;
    outline: none;
}

/* 呼叫按钮 (Primary) */
.call-button {
    width: 100%;
    padding: 12px;
    /* 减小 padding */
    font-size: 15px;
    font-weight: 600;
    color: #fff;
    background: var(--primary-gradient);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 12px rgba(33, 150, 243, 0.25);
}

.call-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
}

.call-button:active {
    transform: translateY(0);
}

/* 摄像头按钮 - 紧凑 */
.camera-button {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-primary);
    background: white;
    border: 1px solid #dfe6e9;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
}

.camera-button:hover {
    background: #f8f9fa;
    border-color: #b2bec3;
    transform: translateY(-1px);
}

/* 次级按钮 */
.secondary-button {
    flex: 1;
    padding: 8px;
    /* 减小 padding */
    font-size: 12px;
    font-weight: 500;
    color: #576574;
    background: #fff;
    border: 1px solid #dfe6e9;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all 0.2s ease;
}

.secondary-button:hover:enabled {
    background: #f1f2f6;
    border-color: #ced6e0;
}

.secondary-button:disabled {
    cursor: not-allowed;
    background: #f5f6fa;
    color: #b2bec3;
    border-color: #f1f2f6;
}

.secondary-button.ghost {
    background: transparent;
    border-style: dashed;
}

/* 确认装载按钮 */
.confirm-button {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    font-size: 14px;
    font-weight: 600;
    color: white;
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
    /* Soft gradient */
    background: linear-gradient(135deg, #FF8008 0%, #FFC837 100%);
    /* Orange gradient */
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(255, 128, 8, 0.25);
}

.confirm-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 128, 8, 0.4);
}

/* ========================================
   6. 状态面板 (Compact)
   ======================================== */
#status-panel {
    margin-top: 0;
    /* Handled by gap */
    padding: 10px 15px;
    /* 减小 padding */
    background: #f8f9fa;
    border-radius: var(--radius-md);
    border: 1px solid #e9ecef;
}

.status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    /* 减小 padding */
    border-bottom: 1px solid #e9ecef;
}

.status-item:last-child {
    border-bottom: none;
}

.status-label {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 500;
}

.status-item span:last-child {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
}

/* 状态Tag样式 */
#status-display {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
}

.status-idle {
    background: #e8f5e9;
    color: #2e7d32 !important;
    animation: glow-green 2s infinite ease-in-out;
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.status-moving {
    background: #e3f2fd;
    color: #1565c0 !important;
    animation: glow-blue 2s infinite ease-in-out;
    border: 1px solid rgba(33, 150, 243, 0.3);
}

.status-waiting {
    background: #fff3e0;
    color: #ef6c00 !important;
    animation: glow-orange 2s infinite ease-in-out;
    border: 1px solid rgba(255, 152, 0, 0.3);
}

.status-arrived {
    background: #e0f7fa;
    color: #00838f !important;
    animation: glow-cyan 2s infinite ease-in-out;
    border: 1px solid rgba(0, 188, 212, 0.3);
}

.status-returning {
    background: #f3e5f5;
    color: #7b1fa2 !important;
    animation: glow-purple 2s infinite ease-in-out;
    border: 1px solid rgba(156, 39, 176, 0.3);
}

@keyframes glow-blue {
    0% {
        box-shadow: 0 0 2px rgba(33, 150, 243, 0.2);
    }

    50% {
        box-shadow: 0 0 6px rgba(33, 150, 243, 0.6);
    }

    100% {
        box-shadow: 0 0 2px rgba(33, 150, 243, 0.2);
    }
}

@keyframes glow-orange {
    0% {
        box-shadow: 0 0 2px rgba(255, 152, 0, 0.2);
    }

    50% {
        box-shadow: 0 0 6px rgba(255, 152, 0, 0.6);
    }

    100% {
        box-shadow: 0 0 2px rgba(255, 152, 0, 0.2);
    }
}

@keyframes glow-cyan {
    0% {
        box-shadow: 0 0 2px rgba(0, 188, 212, 0.2);
    }

    50% {
        box-shadow: 0 0 6px rgba(0, 188, 212, 0.6);
    }

    100% {
        box-shadow: 0 0 2px rgba(0, 188, 212, 0.2);
    }
}

@keyframes glow-purple {
    0% {
        box-shadow: 0 0 0 0 rgba(124, 58, 237, 0.8),
            /* Deep Purple */
            0 0 0 0 rgba(139, 92, 246, 0.6);
        /* Lighter Violet */
    }

    70% {
        box-shadow: 0 0 0 10px rgba(124, 58, 237, 0),
            0 0 0 20px rgba(56, 189, 248, 0);
        /* Cyan fade out */
    }

    100% {
        box-shadow: 0 0 0 0 rgba(124, 58, 237, 0),
            0 0 0 0 rgba(56, 189, 248, 0);
    }
}

.vehicle-glow {
    animation: glow-purple 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
    border-color: #7c3aed !important;
    /* Tech Purple */
}

@keyframes pulse {
    0% {
        opacity: 1;
    }

    50% {
        opacity: 0.7;
    }

    100% {
        opacity: 1;
    }
}

/* ========================================
   7. 加载/装载面板 (Compact)
   ======================================== */
.loading-panel {
    margin-top: 0;
    /* Handled by gap */
    padding: 20px;
    background: #fff8e1;
    border: 1px solid #ffecb3;
    border-radius: var(--radius-md);
    text-align: center;
}

.loading-panel.hidden {
    display: none;
}

.loading-hint {
    font-size: 13px;
    color: #795548;
    margin-bottom: 12px;
}

.transport-code-row {
    background: #fff8e1;
    /* Match parent padding (10px 15px) to stretch full width */
    margin: -10px -15px 10px -15px;
    padding: 12px 20px !important;
    border-radius: var(--radius-md) var(--radius-md) 0 0;
    border-bottom: 1px solid #ffe082;
}

.transport-code-inline {
    font-family: 'Courier New', monospace;
    font-size: 16px;
    font-weight: 700;
    color: #e65100 !important;
    letter-spacing: 2px;
}

/* ========================================
   8. 摄像头模态框 (Modal)
   ======================================== */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(5px);
    z-index: 2000;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 1;
    transition: opacity 0.3s ease;
}

.modal-overlay.hidden {
    display: none;
}

.modal-content {
    width: 800px;
    max-width: 90%;
    width: 800px;
    max-width: 90%;

    /* Glass Modal - Less Transparent */
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border: var(--glass-border);
    box-shadow: var(--glass-shadow);

    border-radius: var(--radius-lg);
    padding: 0;
    overflow: hidden;
    transform: scale(1);
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.modal-overlay.hidden .modal-content {
    transform: scale(0.9);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    background: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
}

.modal-header h3 {
    margin: 0;
    color: var(--text-primary);
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.modal-close {
    background: transparent;
    border: none;
    color: #95a5a6;
    font-size: 24px;
    cursor: pointer;
    transition: color 0.2s;
    line-height: 1;
}

.modal-close:hover {
    color: #e74c3c;
}

/* 摄像头画面区域 */

/* ========================================
   9. 标记动态光晕 (Glow Animations)
   ======================================== */
@keyframes glow-green {
    0% {
        box-shadow: 0 0 2px rgba(76, 175, 80, 0.2), 0 0 4px rgba(76, 175, 80, 0.1);
        border-color: rgba(76, 175, 80, 0.5);
    }

    50% {
        box-shadow: 0 0 8px rgba(76, 175, 80, 0.6), 0 0 16px rgba(76, 175, 80, 0.4);
        border-color: rgba(76, 175, 80, 1);
    }

    100% {
        box-shadow: 0 0 2px rgba(76, 175, 80, 0.2), 0 0 4px rgba(76, 175, 80, 0.1);
        border-color: rgba(76, 175, 80, 0.5);
    }
}

@keyframes glow-red {
    0% {
        box-shadow: 0 0 2px rgba(229, 57, 53, 0.2), 0 0 4px rgba(229, 57, 53, 0.1);
        border-color: rgba(229, 57, 53, 0.5);
    }

    50% {
        box-shadow: 0 0 8px rgba(229, 57, 53, 0.6), 0 0 16px rgba(229, 57, 53, 0.4);
        border-color: rgba(229, 57, 53, 1);
    }

    100% {
        box-shadow: 0 0 2px rgba(229, 57, 53, 0.2), 0 0 4px rgba(229, 57, 53, 0.1);
        border-color: rgba(229, 57, 53, 0.5);
    }
}

.marker-glow-green {
    animation: glow-green 2s infinite ease-in-out;
}

.marker-glow-red {
    animation: glow-red 2s infinite ease-in-out;
}

.marker-glow-purple {
    animation: glow-purple 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
    border-color: #7c3aed !important;
    /* Tech Purple */
}

.camera-feed {
    width: 100%;
    height: 480px;
    background: #000;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
}

.camera-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #7f8c8d;
}

.camera-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.camera-status {
    color: #3498db;
    font-size: 14px;
    margin-bottom: 12px;
}

.ros-info {
    margin-top: 24px;
    padding: 16px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.ros-info code {
    display: block;
    font-family: 'JetBrains Mono', monospace;
    color: #2ecc71;
    font-size: 12px;
    margin: 4px 0;
}

/* 摄像头控制栏 */
.camera-controls {
    display: flex;
    justify-content: center;
    gap: 16px;
    padding: 24px;
    background: #fff;
    border-top: 1px solid #e9ecef;
}

.camera-control-btn {
    background: #fff;
    border: 1px solid #dfe6e9;
    color: var(--text-primary);
    padding: 10px 20px;
    border-radius: 30px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
}

.camera-control-btn:hover:enabled {
    background: #f1f2f6;
    border-color: #b2bec3;
    transform: translateY(-1px);
}

.camera-control-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background: #f5f6fa;
}

/* ========================================
   9. 自定义提示弹窗 (Alert Box)
   ======================================== */
.alert-box {
    width: 400px;
    max-width: 80%;
    text-align: center;
    padding: 0;
    overflow: hidden;
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.alert-body {
    padding: 24px;
    font-size: 15px;
    color: var(--text-primary);
    line-height: 1.6;
}

.alert-footer {
    padding: 10px 24px 16px 24px;
}

.alert-footer .confirm-button {
    margin: 0;
    width: 100%;
}

@keyframes popIn {
    0% {
        transform: scale(0.8);
        opacity: 0;
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* ========================================
   10. Neumorphic Design System (New)
   ======================================== */
:root {
    --neu-bg: #e0e5ec;
    --neu-text: #4a5568;
    --neu-shadow-light: #ffffff;
    --neu-shadow-dark: #a3b1c6;
    --neu-accent: #2196F3;
}

[data-theme="dark"] {
    /* Global Colors */
    --bg-color: #1a1c20;
    --sidebar-bg: rgba(33, 37, 43, 0.95);
    /* Deep Blue-Grey */
    --text-primary: #ecf0f1;
    --text-secondary: #a0aec0;

    /* Neumorphic Dark Theme */
    --neu-bg: #2d3748;

    /* Slate 800 */
    --neu-text: #edf2f7;
    --neu-shadow-light: #354155;
    /* Lighter top-left */
    --neu-shadow-dark: #252d3b;
    /* Darker bottom-right */
    --neu-accent: #63b3ed;

    /* Adjust form elements */
    --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.4);
    --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.5);

    /* Dark Mode Glass */
    --glass-bg: rgba(17, 25, 40, 0.75);
    --glass-border: 1px solid rgba(255, 255, 255, 0.1);
    --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .form-group select {
    background-color: #2d3748;
    color: #edf2f7;
    border-color: #4a5568;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23edf2f7' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
}

[data-theme="dark"] .status-item {
    border-bottom: 1px solid #4a5568;
}

[data-theme="dark"] #status-panel {
    background: #2d3748;
    border: 1px solid #4a5568;
}

[data-theme="dark"] .loading-panel {
    background: #2c2618;
    border-color: #b7791f;
    color: #f6e05e;
}

[data-theme="dark"] .transport-code-row {
    background: #2c2618;
    border-bottom: 1px solid #b7791f;
}

[data-theme="dark"] .loading-hint {
    color: #f6e05e;
}

/* Fix Modal in Dark Mode */
[data-theme="dark"] .modal-content {
    background: #2d3748;
}

[data-theme="dark"] .modal-header {
    background: #2d3748;
    border-bottom: 1px solid #4a5568;
}

[data-theme="dark"] .panel-header {
    background: transparent;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] #control-panel {
    background: var(--glass-bg);
    border-color: rgba(255, 255, 255, 0.1);
}

/* Fix Camera Buttons in Dark Mode */
[data-theme="dark"] .camera-control-btn {
    background: #2d3748;
    border-color: #4a5568;
    color: #edf2f7;
}

[data-theme="dark"] .camera-control-btn:hover:enabled {
    background: #4a5568;
    border-color: #718096;
}

[data-theme="dark"] .camera-control-btn:disabled {
    background: #1a202c;
    color: #718096;
    border-color: #2d3748;
}

[data-theme="dark"] .camera-controls {
    background: #2d3748;
    border-top: 1px solid #4a5568;
}

/* Neumorphic Button Base */
.neumorphic-btn {
    /* Glass Button Style */
    background: var(--glass-bg);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: var(--glass-border);
    color: var(--text-primary);
    border-radius: 12px;
    padding: 12px 20px;
    font-weight: 600;
    letter-spacing: 0.5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.3s ease;

    /* Subtle Shadow */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.neumorphic-btn:hover {
    transform: translateY(-2px);
    color: var(--primary-color);
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 8px 25px rgba(33, 150, 243, 0.2);
    border-color: rgba(255, 255, 255, 0.9);
}

.neumorphic-btn:active {
    transform: translateY(0);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
}

.neumorphic-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    box-shadow: none;
}

/* Small square icon button variant */
.neumorphic-btn.icon-only {
    width: 44px;
    height: 44px;
    padding: 0;
    border-radius: 50%;
    /* Circular */
}

/* Primary Action using Neumorphism + Gradient Text/Icon */
.neumorphic-btn.primary {
    color: var(--primary-color);
}

/* SVG Icon Styling */
.neu-icon {
    width: 20px;
    height: 20px;
    stroke: currentColor;
    fill: none;
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
    filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.1));
    /* Subtle internal depth */
}

/* Override existing buttons to use this style conditionally or replace them */
.call-button.neumorphic-style {
    background: var(--neu-bg);
    color: var(--neu-accent);
    box-shadow: 6px 6px 12px #b8b9be,
        -6px -6px 12px #ffffff;
}

.call-button.neumorphic-style:hover {
    box-shadow: 8px 8px 16px #b8b9be,
        -8px -8px 16px #ffffff;
}

/* ========================================
   11. 底部动作栏 (Floating Action Bar)
   ======================================== */
.action-bar {
    position: absolute;
    bottom: 30px;
    /* Default shown state */
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 500px;
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border: var(--glass-border);
    border-radius: 16px;
    padding: 16px 24px;
    /* Increased padding */
    box-shadow: var(--glass-shadow);
    z-index: 2000;
    /* Above map and controls */

    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;

    transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
}

.action-bar.hidden {
    bottom: -100px;
    /* Hide below screen */
    opacity: 0;
    pointer-events: none;
    transform: translateX(-50%) scale(0.95);
}

.action-content {
    display: flex;
    align-items: center;
    gap: 16px;
    flex: 1;
}

.action-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: #fff8e1;
    border-radius: 14px;
    flex-shrink: 0;
    box-shadow: inset 0 0 0 1px rgba(255, 193, 7, 0.1);
}

.action-text {
    flex: 1;
}

.action-text h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.3;
}

.action-text p {
    margin: 4px 0 0 0;
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.3;
}

/* Contact Button - Full Expanded Gradient */
.nav-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px 20px;
    height: 40px;
    /* Fixed height for consistency */
    border-radius: 20px;

    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;

    border: none;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(118, 75, 162, 0.3);
    transition: all 0.3s ease;
    white-space: nowrap;
    font-size: 14px;
    font-weight: 600;
    gap: 8px;
}

.nav-btn svg {
    margin: 0;
    width: 18px;
    height: 18px;
}

.nav-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(118, 75, 162, 0.5);
}

.nav-btn:active {
    transform: translateY(0);
}

/* Dark Mode btn adjustment if needed, but gradient usually stays */
[data-theme="dark"] .nav-btn {
    /* Keep gradient or adjust brightness? Gradient usually looks good in dark mode too. */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

/* Responsive */
@media (max-width: 768px) {
    .glass-nav {
        min-width: unset;
        width: 90%;
        padding: 0 4px 0 16px;
        height: 56px;
    }

    .nav-label {
        display: none;
    }

    .nav-left {
        gap: 12px;
    }

    .nav-value {
        min-width: unset;
        font-size: 14px;
        padding: 4px 8px;
    }

    /* Make button icon-only on very small screens? Or keep full? 
       User said "fully display", so keep full unless it breaks layout. */
    .nav-btn {
        padding: 8px 16px;
        font-size: 13px;
    }
}

.confirm-button-large {
    padding: 12px 24px;
    background: linear-gradient(135deg, #FF8008 0%, #FFC837 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    white-space: nowrap;
    box-shadow: 0 4px 15px rgba(255, 128, 8, 0.3);
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.confirm-button-large:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 128, 8, 0.4);
}

.confirm-button-large:active {
    transform: translateY(0);
    box-shadow: 0 2px 10px rgba(255, 128, 8, 0.2);
}

/* Dark Mode Support for Action Bar */
[data-theme="dark"] .action-bar {
    background: rgba(45, 55, 72, 0.95);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .action-icon {
    background: rgba(255, 193, 7, 0.15);
    box-shadow: none;
}

[data-theme="dark"] .action-text h3 {
    color: #edf2f7;
}

[data-theme="dark"] .action-text p {
    color: #a0aec0;
}

/* ========================================
   12. 历史记录表格与模态框样式
   ======================================== */
.history-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    text-align: left;
}

.history-table th {
    background: #f8f9fa;
    padding: 12px 16px;
    font-weight: 600;
    color: var(--text-secondary);
    border-bottom: 2px solid #e9ecef;
    position: sticky;
    top: 0;
    z-index: 10;
}

.history-table td {
    padding: 12px 16px;
    border-bottom: 1px solid #e9ecef;
    color: var(--text-primary);
}

.history-table tr:last-child td {
    border-bottom: none;
}

.history-table tr:hover {
    background-color: #f1f2f6;
}

.history-status-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
    background: #e0f2f1;
    color: #00695c;
}

/* Dark Mode Support for History Table */
[data-theme="dark"] .history-table th {
    background: #2d3748;
    color: #a0aec0;
    border-bottom-color: #4a5568;
}

[data-theme="dark"] .history-table td {
    border-bottom-color: #4a5568;
    color: #edf2f7;
}

[data-theme="dark"] .history-table tr:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .history-status-badge {
    background: rgba(0, 105, 92, 0.3);
    color: #80cbc4;
}

[data-theme="dark"] #no-history-msg {
    color: #a0aec0 !important;
}

/* ========================================
   Weather Display (Top Right)
   ======================================== */
#weather-display {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 100;

    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 20px;

    /* Premium Glassmorphism */
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border: var(--glass-border);
    box-shadow: var(--glass-shadow);
    border-radius: 20px;

    transition: all 0.3s ease;
}

[data-theme="dark"] #weather-display {
    background: rgba(30, 30, 30, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #e0e0e0;
}

.weather-icon {
    font-size: 28px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}

.weather-info {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.weather-temp {
    font-size: 20px;
    font-weight: 700;
    line-height: 1;
    color: var(--text-primary);
}

.weather-text {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 2px;
}

/* Bad Weather State */
#weather-display.bad-weather {
    background: rgba(255, 235, 238, 0.9);
    border: 1px solid #ffcdd2;
    animation: pulse-red 2s infinite;
}

[data-theme="dark"] #weather-display.bad-weather {
    background: rgba(60, 20, 20, 0.8);
    border-color: #ef9a9a;
}

#weather-display.bad-weather .weather-text {
    color: #d32f2f;
    font-weight: bold;
}

[data-theme="dark"] #weather-display.bad-weather .weather-text {
    color: #ffcdd2;
}

@keyframes pulse-red {
    0% {
        box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4);
    }

    70% {
        box-shadow: 0 0 0 10px rgba(244, 67, 54, 0);
    }

    100% {
        box-shadow: 0 0 0 0 rgba(244, 67, 54, 0);
    }
}

/* ========================================
   Weather Visual Effects (Overlay)
   ======================================== */
#weather-effect-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    /* Pass clicks through */
    z-index: 9999;
    /* Ensure it is on top of everything */
    overflow: hidden;
    display: none;
    /* Hidden by default */
    z-index: 50;
    /* Above the map but below the control panels (z-index: 100) */
}

/* Rain Effect - Vertical, Thin, Blurred & Cloud */
#weather-effect-overlay.weather-rain {
    display: block !important;
    /* Layers:
       1. Dark Cloud Gradient (Top) - Lighter
       2. Foreground Rain (Faster) - Vertical, Thin
       3. Background Rain (Slower) - Vertical, Very Thin
    */
    background-image:
        linear-gradient(to bottom, rgba(40, 50, 60, 0.6) 0%, rgba(40, 50, 60, 0) 40%),
        url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20,10 L20,30' stroke='rgba(255,255,255,0.6)' stroke-width='1' stroke-linecap='round'/%3E%3Cpath d='M60,40 L60,55' stroke='rgba(255,255,255,0.5)' stroke-width='0.8' stroke-linecap='round'/%3E%3Cpath d='M90,10 L90,25' stroke='rgba(255,255,255,0.5)' stroke-width='0.8' stroke-linecap='round'/%3E%3C/svg%3E"),
        url("data:image/svg+xml,%3Csvg width='120' height='120' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30,10 L30,22' stroke='rgba(255,255,255,0.3)' stroke-width='0.6' stroke-linecap='round'/%3E%3Cpath d='M80,60 L80,72' stroke='rgba(255,255,255,0.3)' stroke-width='0.6' stroke-linecap='round'/%3E%3C/svg%3E");

    background-size: 100% 100%, 300px 300px, 400px 400px;
    background-repeat: no-repeat, repeat, repeat;
    animation: rain-fall 0.6s linear infinite;
    opacity: 0.9;
    background-color: transparent;
    filter: blur(0.5px);
    /* Soften the rain */
    backdrop-filter: brightness(0.9);
    /* Slightly darken map */
}

@keyframes rain-fall {
    0% {
        /* Cloud stays static (0 0), Rain moves */
        background-position: 0 0, 0 0, 0 0;
    }

    100% {
        background-position: 0 0, 0 300px, 0 400px;
    }
}

/* Sunlight Effect */
#weather-effect-overlay.weather-sun {
    display: block !important;
    background: radial-gradient(circle at 10% 10%, rgba(255, 255, 150, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 90% 90%, rgba(255, 200, 50, 0.1) 0%, transparent 50%);
    box-shadow: inset 0 0 100px rgba(255, 220, 100, 0.1);
    animation: sun-glimmer 12s ease-in-out infinite;
}

@keyframes sun-glimmer {

    0%,
    100% {
        opacity: 0.4;
    }

    50% {
        opacity: 0.7;
    }
}

/* Snow Effect */
#weather-effect-overlay.weather-snow {
    display: block !important;
    /* Layer 1: Dark Cloud Gradient (Top) - Lighter */
    /* Layer 2: Snowflakes (Larger) */
    background-image:
        linear-gradient(to bottom, rgba(40, 50, 60, 0.6) 0%, rgba(40, 50, 60, 0) 40%),
        radial-gradient(4px 4px at 20% 30%, white 50%, transparent 60%),
        radial-gradient(3px 3px at 40% 70%, white 50%, transparent 60%),
        radial-gradient(5px 5px at 60% 20%, white 50%, transparent 60%),
        radial-gradient(4px 4px at 80% 50%, white 50%, transparent 60%),
        radial-gradient(3px 3px at 10% 90%, white 50%, transparent 60%);

    background-size: 100% 100%, 250px 250px, 250px 250px, 250px 250px, 250px 250px, 250px 250px;
    background-repeat: no-repeat, repeat, repeat, repeat, repeat, repeat;
    animation: snow-fall 8s linear infinite;
    opacity: 0.95;
    /* Slightly darker backdrop for snow */
    backdrop-filter: brightness(0.85);
}

@keyframes snow-fall {
    0% {
        /* Keep cloud static (0 0), Move snow */
        background-position: 0 0, 0 0, 0 0, 0 0, 0 0, 0 0;
    }

    100% {
        background-position: 0 0, 20px 250px, 20px 250px, 20px 250px, 20px 250px, 20px 250px;
    }
}

/* Route Mode Selection Badge */
.selection-badge {
    display: inline-flex;
    align-items: center;
    padding: 2px 10px;
    font-size: 11px;
    font-weight: 500;
    color: var(--text-secondary);
    border: 1px solid #dfe6e9;
    border-radius: 20px;
    background: white;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    margin-left: auto;
    /* ensure it pushes right if needed */
    transition: all 0.3s ease;
}

.selection-badge.hidden {
    opacity: 0;
    transform: scale(0.95);
    pointer-events: none;
    display: none;
    /* Force hide layout */
}

/* Accentuate count */
.selection-badge span {
    color: var(--primary-color);
    font-weight: 700;
    margin-left: 4px;
}

/* ========================================
   12. Bottom Dynamic Island (New Navigation)
   ======================================== */
.dynamic-island-bottom {
    position: fixed;
    bottom: 40px;
    /* Increased bottom spacing */
    left: 50%;
    transform: translateX(-50%);
    width: auto;
    min-width: 480px;
    /* Increased min-width */
    max-width: 90%;
    height: auto;
    min-height: 80px;
    /* Increased height */

    background: var(--glass-bg);
    /* Slightly more opaque */
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border: var(--glass-border);
    border-radius: 50px;
    /* Rounder */

    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2),
        /* Deeper shadow */
        0 6px 20px rgba(0, 0, 0, 0.1);

    display: flex;
    justify-content: center;
    align-items: center;
    padding: 12px 24px;
    /* Increased padding */

    z-index: 2000;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);

    /* Origin for expansion animation */
    transform-origin: center bottom;
}

[data-theme="dark"] .dynamic-island-bottom {
    background: rgba(30, 41, 59, 0.95);
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
}

.dynamic-island-bottom.hidden {
    transform: translateX(-50%) translateY(150px) scale(0.8);
    opacity: 0;
    pointer-events: none;
}

/* Island Content Handling */
.island-content {
    display: flex;
    align-items: center;
    gap: 24px;
    /* Increased gap */
    width: 100%;
    justify-content: space-between;
    padding: 0 12px;

    /* Animation for content switch */
    animation: fadeInContent 0.4s ease-out;
}

.island-content.hidden {
    display: none;
}

@keyframes fadeInContent {
    from {
        opacity: 0;
        transform: scale(0.95);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* 1. Waiting State */
.island-icon-pulse {
    width: 56px;
    /* Increased icon size */
    height: 56px;
    border-radius: 50%;
    background: rgba(33, 150, 243, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    animation: pulse-soft 2s infinite;
}

.island-icon-pulse .neu-icon {
    width: 32px;
    /* Increased svg size */
    height: 32px;
}

.island-text h3 {
    font-size: 18px;
    /* Increased title font */
    font-weight: 800;
    /* Bolder */
    margin: 0;
    color: var(--text-primary);
}

.island-text p {
    font-size: 14px;
    /* Increased subtitle font */
    margin: 4px 0 0 0;
    color: var(--text-secondary);
}

/* 2. Pickup State */
.island-info-block {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.island-info-block .label {
    font-size: 12px;
    /* Larger label */
    text-transform: uppercase;
    color: var(--text-secondary);
    letter-spacing: 0.5px;
    font-weight: 700;
}

.island-info-block .code-value {
    font-family: 'Consolas', monospace;
    font-size: 28px;
    /* Larger code */
    font-weight: 900;
    color: var(--primary-color);
    letter-spacing: 3px;
    line-height: 1.2;
}

.island-divider {
    width: 2px;
    /* Thicker divider */
    height: 40px;
    background: rgba(0, 0, 0, 0.1);
}

[data-theme="dark"] .island-divider {
    background: rgba(255, 255, 255, 0.15);
}

.island-action-btn {
    padding: 14px 28px;
    /* Larger button */
    border-radius: 30px;
    font-size: 16px;
    /* Larger text */
    font-weight: 700;
    cursor: pointer;
    border: none;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Premium Primary Button: Vibrant Blue/Purple Gradient */
.island-action-btn.primary {
    background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
    color: white;
    box-shadow: 0 8px 20px rgba(33, 203, 243, 0.4);
}

.island-action-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 28px rgba(33, 203, 243, 0.5);
    filter: brightness(1.05);
}

.island-action-btn.primary:active {
    transform: translateY(0);
}

/* 3. Moving State */
.island-status-row {
    display: flex;
    align-items: center;
    gap: 16px;
}

.island-icon-spin {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(76, 175, 80, 0.1);
    border-radius: 50%;
}

.island-icon-spin .neu-icon {
    width: 28px;
    height: 28px;
    animation: spin 3s linear infinite;
}

.island-text-compact h3 {
    font-size: 16px;
    margin: 0;
    font-weight: 800;
    color: var(--text-primary);
}

.island-data-block {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}

.island-data-block .label {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 600;
}

.island-data-block .value-highlight {
    font-size: 24px;
    /* Larger speed display */
    font-weight: 800;
    color: #4CAF50;
    font-variant-numeric: tabular-nums;
    text-shadow: 0 2px 10px rgba(76, 175, 80, 0.2);
}

/* 4. Arrived State */
.island-icon-success {
    width: 56px;
    /* Larger success icon */
    height: 56px;
    border-radius: 50%;
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 6px 15px rgba(56, 249, 215, 0.4);
}

.island-icon-success .neu-icon {
    width: 32px;
    height: 32px;
    color: #00695c;
    /* Darker icon color for contrast against bright gradient */
}

/* Premium Success Button: Vibrant Green/Teal Gradient */
.island-action-btn.success {
    background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
    color: white;
    box-shadow: 0 8px 20px rgba(0, 176, 155, 0.4);
}

.island-action-btn.success:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 28px rgba(0, 176, 155, 0.5);
    filter: brightness(1.05);
}

/* Animations */
@keyframes spin {
    100% {
        transform: rotate(360deg);
    }
}

@keyframes pulse-soft {
    0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.4);
    }

    70% {
        transform: scale(1);
        box-shadow: 0 0 0 15px rgba(33, 150, 243, 0);
    }

    100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(33, 150, 243, 0);
    }
}

/* Responsive */
@media (max-width: 600px) {
    .dynamic-island-bottom {
        min-width: 90%;
        bottom: 25px;
        flex-direction: column;
        /* Stack vertically on small screens */
        padding: 16px;
        min-height: auto;
        border-radius: 30px;
    }

    .island-content {
        flex-direction: column;
        gap: 16px;
        text-align: center;
    }

    .island-text h3 {
        font-size: 16px;
    }

    .island-text p {
        font-size: 12px;
    }

    .island-action-btn {
        width: 100%;
        justify-content: center;
        padding: 12px;
    }

    .island-info-block {
        align-items: center;
    }

    .island-divider {
        width: 80%;
        height: 1px;
        /* Horizontal divider for column layout */
        margin: 8px 0;
    }

    .island-status-row {
        flex-direction: column;
        gap: 8px;
    }

    .island-data-block {
        align-items: center;
    }
}

/* ========================================
   Action Required Glow Effects
   ======================================== */
.island-glow-primary {
    animation: island-pulse-primary 2s infinite;
}

.island-glow-success {
    animation: island-pulse-success 2s infinite;
}

@keyframes island-pulse-primary {
    0% {
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2), 0 0 0 0 rgba(33, 150, 243, 0.6);
    }

    70% {
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2), 0 0 0 20px rgba(33, 150, 243, 0);
    }

    100% {
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2), 0 0 0 0 rgba(33, 150, 243, 0);
    }
}

@keyframes island-pulse-success {
    0% {
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2), 0 0 0 0 rgba(76, 175, 80, 0.6);
    }

    70% {
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2), 0 0 0 20px rgba(76, 175, 80, 0);
    }

    100% {
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2), 0 0 0 0 rgba(76, 175, 80, 0);
    }
}

/* ========================================
   13. Mobile Adaptation & Version Switching
   ======================================== */

/* App Root Container */
#app-root {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
    background-color: var(--secondary-color);
    transition: all 0.3s ease;
}

/* Version Controls (Buttons) */
#version-controls {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 99999;
    /* Top level */
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.switch-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 30px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
}

.switch-btn:hover {
    transform: translateY(-2px);
    background: white;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    color: var(--primary-color);
}

.switch-btn span {
    font-size: 18px;
}

#to-mobile-btn {
    display: flex;
    /* Visible by default on PC */
}

#to-pc-btn {
    display: none;
    /* Hidden by default (PC mode) */
    background: #2c3e50;
    color: white;
}

#to-pc-btn:hover {
    background: #34495e;
    color: #fff;
}


/* ========================================
   14. Vertical Mode (Portrait / Mobile)
   ======================================== */
/* 
   Applied via JS detection (.vertical-mode) 
   OR via Media Query for native behavior 
*/

/* Shared Vertical Layout Logic */
@media (max-aspect-ratio: 13/9) {
    /* 
       On wide screens (Simulated Vertical): 
       Constrain width to simulate mobile/tablet ratio.
       On actual narrow screens: 
       This max-width won't trigger or will be equal to screen.
    */
    /* Base for simulated vertical mode on wide screen */
}

/* Specific behaviors for explicit Vertical Mode class (Simulation or Manual Toggle) */
body.vertical-mode {
    /* Allow full screen usage, no background bars */
    background-color: var(--bg-color);
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    margin: 0;
}

body.vertical-mode #app-root {
    width: 100%;
    /* Remove max-width constraint so it fills the screen even on tablets/large vertical monitors */
    max-width: none;
    height: 100%;
    position: relative;
    box-shadow: none;
}

/* Adjust control placement when in explicit vertical mode */
body.vertical-mode #version-controls {
    position: fixed;
    bottom: 90px;
    /* Above bottom sheet peak (60px) + spacing */
    right: 20px;
    transform: none;
    z-index: 100000;
}


/* ========================================
   15. Horizontal Mode (PC / Landscape)
   ======================================== */
.horizontal-mode #app-root {
    width: 100%;
    height: 100%;
    max-width: none;
}

.horizontal-mode #version-controls {
    position: fixed;
    bottom: 20px;
    left: 20px;
    right: auto;
}


/* ========================================
   16. Responsive / Vertical Layout Styles
   ======================================== */

/* 
   Apply these styles when:
   1. Screen is naturally narrow (max-width: 768px)
   2. Screen is naturally portrait (max-aspect-ratio: 13/9 or similar? Safe to stick to width/class for now)
   3. Force .vertical-mode class is present
*/

@media (max-width: 768px) {

    /* --- 1. Top Nav (Floating Dynamic Island) --- */
    .glass-nav {
        /* Restore floating island look */
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 400px;
        min-width: 0;

        border-radius: 30px;
        padding: 8px 16px;
        height: auto;
        flex-wrap: wrap;
        /* Allow stacking if needed */
        justify-content: center;
        gap: 8px;

        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.8);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    }

    .nav-left {
        width: 100%;
        justify-content: space-around;
        /* Distribute evenly */
        gap: 0;
    }

    .nav-item {
        flex-direction: column;
        gap: 2px;
        align-items: center;
    }

    .nav-label {
        font-size: 10px;
        display: block;
        margin-bottom: 0;
        text-transform: uppercase;
        opacity: 0.7;
    }

    .nav-value {
        font-size: 13px;
        padding: 2px 6px;
        min-width: 0;
        border-radius: 8px;
        /* Softer look */
    }

    .nav-divider {
        display: none;
    }

    /* Hide Contact Button Text, keep icon floating? 
       Actually user might want it accessible. 
       Let's put it in the row or absolute. */
    .nav-right {
        display: none;
        /* Hide large button */
    }

    /* Add a small floating contact button if needed? 
       Maybe integrate into the row? 
       For now, let's assume it's okay to hide or we add a small icon in nav-left.
       Let's leave it hidden to save space as per "Compact" request.
    */

    /* --- 2. Weather --- */
    #weather-display {
        /* Move further down to ensure no overlap with floating nav (which can expand) */
        top: 130px;
        right: 20px;
        transform: none;
        padding: 6px 12px;
        /* Ensure z-index is lower than nav if they do overlap, but better to space them */
        z-index: 900;
    }

    .weather-text {
        display: none;
    }

    /* --- 3. Control Panel (Bottom Sheet) --- */
    #control-panel {
        top: auto !important;
        bottom: 0;
        left: 0;
        width: 100% !important;
        max-width: 100%;
        height: auto;
        /* Default: Header visible */
        transform: translateY(calc(100% - 70px));

        border-radius: 24px 24px 0 0;
        border-bottom: none;
        margin: 0;
        padding-bottom: 30px;
        z-index: 2000;
        position: absolute;
        transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
    }

    #control-panel::before {
        content: '';
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 32px;
        height: 4px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 2px;
        z-index: 2001;
    }

    #control-panel.expanded {
        transform: translateY(0);
    }

    .panel-header {
        cursor: pointer;
        padding: 16px 24px;
    }

    /* Remove gradient header bg in mobile to look cleaner white? 
       Or keep it. Keep it. */

    /* --- 4. Dynamic Island Status --- */
    .dynamic-island-bottom {
        bottom: 90px;
        /* Above header */
        width: 90%;
        max-width: 400px;
        min-width: 0;
        flex-direction: column;
        padding: 12px;
        border-radius: 24px;
        z-index: 1500;

        /* Ensure it's centered */
        left: 50%;
        transform: translateX(-50%);
    }

    .island-content {
        gap: 8px;
        flex-direction: column;
        text-align: center;
    }

    .island-divider {
        width: 100%;
        height: 1px;
        margin: 4px 0;
    }

    .island-status-row {
        flex-direction: column;
    }
}

/* Explicit overrides for the specific .vertical-mode class (redundant with above group selector but ensures specificity over ID rules elsewhere) */
.vertical-mode .glass-nav {
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 400px;
    border-radius: 30px;
    padding: 8px 16px;
    height: auto;
    flex-wrap: wrap;
    justify-content: center;
}

.vertical-mode #control-panel {
    top: auto !important;
    bottom: 0;
    left: 0;
    width: 100% !important;
    margin: 0;
    transform: translateY(calc(100% - 70px));
    height: auto;
    border-radius: 24px 24px 0 0;
    border-bottom: none;
    padding-bottom: 30px;
    position: absolute;
}

.vertical-mode #control-panel.expanded {
    transform: translateY(0);
}

.vertical-mode .dynamic-island-bottom {
    bottom: 90px;
    width: 90%;
    max-width: 400px;
    min-width: 0;
    flex-direction: column;
    left: 50%;
    transform: translateX(-50%);
}

/* --- 5. Weather Widget (Bottom Left - Aligned with Version Switch) --- */
.vertical-mode #weather-display {
    /* Reset manual manual positioning if any */
    top: auto;
    right: auto;
    left: auto;
    transform: none;

    /* Position relative to bottom */
    position: absolute;
    bottom: 90px;
    /* Match #version-controls bottom */
    left: 20px;
    /* Bottom Left Corner */

    /* Auto width (Compact) */
    width: auto;
    max-width: none;

    /* Box Styling */
    padding: 6px 12px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.95);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.8);

    /* Flex Alignment */
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;

    z-index: 900;
}

/* Dark Mode Override for Vertical Mode Weather Widget */
[data-theme="dark"] .vertical-mode #weather-display {
    background: rgba(30, 30, 30, 0.95) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    color: #e0e0e0 !important;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3) !important;
}

[data-theme="dark"] .vertical-mode #weather-display .weather-temp,
[data-theme="dark"] .vertical-mode #weather-display .weather-text,
[data-theme="dark"] .vertical-mode #weather-display .weather-icon {
    color: #e0e0e0 !important;
}
/* Disabled Custom Option Style */
.custom-option.disabled {
    background-color: #f5f5f5;
    color: #bdc3c7;
    cursor: not-allowed;
    pointer-events: none;
    font-style: italic;
}
